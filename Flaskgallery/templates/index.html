<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Photography Gallery</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- Header -->
<header class="header">
  <nav class="nav">
    <a href="{{ url_for('index') }}">Home</a>
    {% if logged_in %}
      <a href="{{ url_for('logout') }}">Logout</a>
    {% else %}
      <a href="{{ url_for('login') }}">Login</a>
    {% endif %}
  </nav>
  <div class="banner">
    <h1>Photography Gallery</h1>
  </div>
</header>

<!-- Content / Gallery -->
<main class="content">
  <div class="categories">
    <button onclick="filterCategory('All')">All</button>
    {% for cat in categories %}
      <button onclick="filterCategory('{{ cat }}')">{{ cat }}</button>
    {% endfor %}
  </div>

  <div class="gallery">
    {% for img in images %}
      <div class="gallery-item" 
           onclick="openModal(this)"
           data-filename="{{ img.filename }}"
           data-title="{{ img.title }}"
           data-category="{{ img.category }}"
           data-date="{{ img.date }}">
        <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" alt="{{ img.title }}">
        {% if logged_in %}
          <a href="{{ url_for('delete', filename=img.filename) }}" class="delete-btn" onclick="event.stopPropagation(); return confirm('Delete this image?')">Ã—</a>
        {% endif %}
      </div>
    {% endfor %}

    {% if logged_in %}
      <div class="gallery-item-wrapper">
        <div class="gallery-item upload">
          <form class="upload-button" method="post" enctype="multipart/form-data">
            <input type="file" name="file" onchange="this.form.submit()">
            <span class="plus">+</span>
          </form>
        </div>
      </div>
    {% endif %}
  </div>
</main>

<!-- Edit / Lightbox Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <img id="modalImage" src="" alt="">

    <form id="editForm" method="post" class="modal-details-form">
      <div class="modal-details">
        <div class="detail">
          <label>Title:</label>
          <input type="text" id="modalTitle" name="title" readonly>
        </div>
        <div class="detail">
          <label>Category:</label>
          <input type="text" id="modalCategory" name="category" readonly>
        </div>
        <div class="detail">
          <label>Date:</label>
          <input type="datetime-local" id="modalDate" name="date" readonly>
        </div>
      </div>
      <div class="modal-buttons">
        <button type="button" onclick="closeModal()">Close</button>
        <button type="submit" id="saveButton" style="display:none;">Save</button>
      </div>
    </form>
  </div>
</div>


<!-- Footer -->
<footer class="footer">
  <p>&copy; 2025 My Photography Gallery</p>
</footer>

<script>
// Open modal
function openModal(img) {
  const modal = document.getElementById('editModal');
  const modalImg = document.getElementById('modalImage');
  const titleInput = document.getElementById('modalTitle');
  const categoryInput = document.getElementById('modalCategory');
  const dateInput = document.getElementById('modalDate');
  const saveButton = document.getElementById('saveButton');
  const form = document.getElementById('editForm');

  modalImg.src = img.querySelector('img').src;
  modalImg.alt = img.dataset.title;

  titleInput.value = img.dataset.title;
  categoryInput.value = img.dataset.category;
  dateInput.value = img.dataset.date.slice(0,16);

  if ({{ 'true' if logged_in else 'false' }}) {
    titleInput.removeAttribute('readonly');
    categoryInput.removeAttribute('readonly');
    dateInput.removeAttribute('readonly');
    saveButton.style.display = 'block';
    form.action = "/edit/" + img.dataset.filename;
  } else {
    titleInput.setAttribute('readonly', true);
    categoryInput.setAttribute('readonly', true);
    dateInput.setAttribute('readonly', true);
    saveButton.style.display = 'none';
  }

  modal.style.display = 'flex';
}

// Close modal
function closeModal() {
  document.getElementById('editModal').style.display = 'none';
}

// Close when clicking outside content
document.getElementById('editModal').addEventListener('click', function(e){
  if(e.target === this) closeModal();
});

function filterCategory(cat) {
  let items = document.querySelectorAll('.gallery-item');
  items.forEach(item => {
    // Always keep the upload button visible
    if(item.classList.contains('upload')) {
      item.style.display = 'flex';
    } 
    // Show item if category matches or "All" is selected
    else if(cat === 'All' || item.dataset.category === cat) {
      item.style.display = 'block';
    } 
    // Otherwise hide it
    else {
      item.style.display = 'none';
    }
  });
}



</script>
</body>
</html>
